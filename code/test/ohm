#!/usr/bin/env perl
use warnings;
use strict;
use utf8;
use feature qw( current_sub );
use File::Basename;
use File::Path;
use JSON::XS;
use Storable qw(dclone);
use Carp qw(croak carp);
use Cwd;
use Try::Tiny;
use Data::Dumper;

$SIG{__DIE__} = sub
{
    $DB::single = 1;
    $DB::signal = 1;
};

use lib ($ENV{HOME}.'/hmofa/hmofa/code/test/lib');
use Ohm::Controller;

my $args = #{{{1
({
    paths =>
    {
        input => './.ohm/db/output.txt',
        dspt  => './dspt_deimos.json',
        drsr  => './.ohm/db/drsr.json',
        sdrsr =>
        [
            './.ohm/db/sdrsr/kk.json'
        ],
        mask  => './.ohm/db/drsr.json',
        smask =>
        [
            './.ohm/db/smask/catalog.json',
            './.ohm/db/smask/masterbin.json',
        ],
    },
    db_opts =>
    {
        plhd => {},
        prsv_opts  =>
        {
            till =>
            [
                'section',
                0
            ]
        },
    },

});#}}}

my $c = Ohm::Controller->new($args);
my $data = $c->importFromPaths();
$data->{opts} = $c->{db_opts};
$c->genDb( {dspt => $data->{dspt} });
$c->{db}{input} = $data->{input};
$c->{db}->get_matches();
$c->{db}->__divy();
$c->{db}->__sweep(['reffs']);

$DB::single = 1;
$DB::signal = 1;
